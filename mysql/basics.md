mysql架构分为两层：server层和存储引擎层，server层主要负责建立连接、分析和执行sql。主要包括连接器、查缓存。解析器、预处理器、优化器、执行器等。存储引擎层负责数据的存取。
### mysql的执行流程
1. 连接器
```
mysql -u$user -p 来连接mysql服务，连接的过程先经过TCP三次握手，mysql基于TCP协议进行传输。
show processlist 来查看服务有多少的客户连接，mysql空闲连接最大时长由wait_timeout参数控制，默认八小时。
mysql的链接也有长连接和短连接的概念：
// 短连接
连接 mysql 服务（TCP 三次握手）
执行sql
断开 mysql 服务（TCP 四次挥手）

// 长连接
连接 mysql 服务（TCP 三次握手）
执行sql
执行sql
执行sql
....
断开 mysql 服务（TCP 四次挥手）

长连接会更多的占用内存，一般有两种解决方式：
1.定期断开长连接
2.客户端主动重置连接，调用mysql_reset_connection
```
2.查询缓存
```
客户端向服务端发送了sql语句，服务端会解析sql语句的第一个字段，看是什么类型的语句。如果是select语句就会去查询缓存，在缓存里查找看之前是否
执行过这一条命令，这个查询缓存是以 key-value 形式保存在内存中的，key 为 sql 查询语句，value 为 sql 语句查询的结果。但对于更新比较频
繁的表，查询缓存的命中率是比较低的，因为只要表有更新，这个表的查询缓存就会被清空。
```
3.解析sql
```
1.词法解析，根据你输入的字符串识别出关键字，构建sql语法树
2.语法分析，根据词法分析的结果，语法解析器会根据语法规则，判断你输入的sql语句是否满足mysql语法。
```
4.执行sql
```
prepare 阶段，也就是预处理阶段；检查表和表中的字段是否存在。
optimize 阶段，也就是优化阶段；优化器主要负责将 SQL 查询语句的执行方案确定下来，比如在表里面有多个索引的时候，优化器会基于查询成本的考虑，
来决定选择使用哪个索引。
execute 阶段，也就是执行阶段；确定好执行方案，执行器就会和存储引擎交互。

```